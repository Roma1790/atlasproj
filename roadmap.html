<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Kostenabschätzung</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css"
      integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <style>
      .task-list-item {
        list-style-type: none;
      }
      .task-list-item-checkbox {
        margin-left: -20px;
        vertical-align: middle;
      }
    </style>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif;
        font-size: 14px;
        line-height: 1.6;
      }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
  </head>
  <body class="vscode-light">
    <h1 id="kostenabsch%c3%a4tzung">Kostenabschätzung</h1>
    <h2 id="google-vs-mapbox">google vs mapbox</h2>
    <p>
      Google bietet keine Möglichkeit an einzelne Tiles zu laden, sondern rechnet lediglich mit map loads. Interaktionen
      wie Zoomen, Bewegen der Karte oder andere Arten neue Tiles zu laden werden nicht berücksichtigt. Daher gibt es
      auch keine Preisdaten die wir gut vergleichen könnten.
    </p>
    <p>
      Mapbox bietet zwar auch diese Möglichkeit an nur für einen map load zu zahlen, jedoch nur wenn man deren eigene -
      auf <a href="https://leafletjs.com/">leaflet.js</a> basierende -
      <a href="https://docs.mapbox.com/mapbox-gl-js/api/">Bibliothek</a> benutzt.
    </p>
    <h3 id="vergleich">Vergleich</h3>
    <p>| Current requests | per month |# Kostenabschätzung</p>
    <h2 id="google-vs-mapbox-1">google vs mapbox</h2>
    <p>
      Google bietet keine Möglichkeit an einzelne Tiles zu laden, sondern rechnet lediglich mit map loads. Interaktionen
      wie Zoomen, Bewegen der Karte oder andere Arten neue Tiles zu laden werden nicht berücksichtigt. Daher gibt es
      auch keine Preisdaten die wir gut vergleichen könnten.
    </p>
    <p>
      Mapbox bietet zwar auch diese Möglichkeit an nur für einen map load zu zahlen, jedoch nur wenn man deren eigene -
      auf <a href="https://leafletjs.com/">leaflet.js</a> basierende -
      <a href="https://docs.mapbox.com/mapbox-gl-js/api/">Bibliothek</a> benutzt.
    </p>
    <h3 id="vergleich-1">Vergleich</h3>
    <table>
      <thead>
        <tr>
          <th>Current requests</th>
          <th>per month</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>mapload</td>
          <td>40.000</td>
        </tr>
        <tr>
          <td>geocoding</td>
          <td>55.000</td>
        </tr>
      </tbody>
    </table>
    <p>
      <img
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9t676f9uY6NktXtffQfe2WpzRjW7UsmaNxiS427Ej2SLTbmYqBIu2RqKppTpH9FvdssKJSDzg5f3L/pubchart?oid=107232545&amp;format=image"
        alt="Geocoding"
      />
    </p>
    <p>
      <img
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9t676f9uY6NktXtffQfe2WpzRjW7UsmaNxiS427Ej2SLTbmYqBIu2RqKppTpH9FvdssKJSDzg5f3L/pubchart?oid=20924636&amp;format=image"
        alt="MapLoads"
      />
    </p>
    <p>
      <img
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9t676f9uY6NktXtffQfe2WpzRjW7UsmaNxiS427Ej2SLTbmYqBIu2RqKppTpH9FvdssKJSDzg5f3L/pubchart?oid=308843151&amp;format=image"
        alt="TileLoads"
      />
    </p>
    <h3 id="umrechnung">Umrechnung</h3>
    <p>
      Ich habe leider nirgendwo einen guten Vergleich gefunden, auch keine Erfahrungsberichte von Leuten die gewechselt
      und ihre Zahlen veröffentlicht haben.
    </p>
    <p>
      Derzeit erreichen wir ca. 40.000 Maploads pro Monat, also ca $80. Für den selben Preis erhalten wir bei Mapbox
      320.000 Tile requests. Bei 40.000 Usern sind das dann 8 Tiles pro User.
    </p>
    <p>
      Für eine detailierte Suche ist das sicherlich nicht ausreichend, aber gleichzeitig gibt es vermutlich auch viele,
      die einfach nur auf die Seite gehen und nicht mit der Karte interagieren.
    </p>
    <p>
      Meine Vermutung ist, dass wir mehr für die Tiles zahlen, jedoch die Kosten für Forward und Reverse Geocoding gegen
      0 gehen werden.
    </p>
    <p>
      Um genau herauszufinden wie viele Tiles der durchschnittliche User benötigt, sollten wir das ganze am besten
      einfach austesten. <a href="#Tests">&gt;Tests</a>
    </p>
    <h2 id="free">Free</h2>
    <p>
      Für die Beschaffung der geojson Polygone für z.B. Länderumrisse werden wir sowieso weiterhin
      <a href="https://nominatim.openstreetmap.org/">Nominatim</a> verwenden. Diese Anfragen müssen allerdings gecached
      werden, da Nominatim ein Ratelimit von 1 req/s angibt. <a href="#ProxyServer">&gt;Server</a>
    </p>
    <p>
      Hier kann man sich dann überlegen ob es nicht sinnvoller wäre alle Geocoding Anfragen über Nominatim zu erledigen.
      Solange die Anfragen gecached werden, sehe ich hier keine Nachteile.
    </p>
    <p>
      Matrix oder Isochrone Anfragen zu einem späteren Zeitpunkt müssten dann allerdings trotzdem über Mapbox oder einen
      anderen Anbieter gehen.
    </p>
    <h1 id="tests">Tests</h1>
    <p>
      Wie mit Birgit kurz besprochen werde ich dem Server noch ein paar Logging Funktionen hinzufügen,sodass wir nach
      dem Test abschätzen können, wie die Karte genutzt wird.
    </p>
    <p>Hierfür wäre natürlich wichtig zu definieren, was wir alles wissen wollen.</p>
    <ul>
      <li>Requested Tiles pro User</li>
      <li>Suchanfragen</li>
      <li>???</li>
    </ul>
    <h1 id="aufwandsabsch%c3%a4tzung">Aufwandsabschätzung</h1>
    <h2 id="proxyserver">ProxyServer</h2>
    <p><a href="https://github.com/chronark/charon">github.com/chronark/charon</a></p>
    <p>
      Ich habe vor 1-2 Monaten aus Spaß zu Hause an einer Cache-Implementation in
      <a href="https://golang.org/">go</a> gebastelt, weil ich dachte, dass man sich damit eigentlich sämtliche Kosten
      sparen könnte, da die Anfragen immer weniger sind als das Gratis-Limit. Der server ist derzeit unter
      <a href="jbs-osm.informatik.fh-nuernberg.de">jbs-osm.informatik.fh-nuernberg</a> zu finden.
    </p>
    <p>Leider verstößt das gegen die <a href="https://www.mapbox.com/legal/tos">TOS</a> (2.8) von Mapbox.</p>
    <p>Auch wenn wir Tiles und Geocoding von mapbox nicht cachen dürfen, gibt es trotzdem einige Vorteile:</p>
    <ul>
      <li>
        Secrets für diverse APIs erst beim Server hinzugefügt, damit diese nicht im javascript code an den Endnutzer
        weiter gegeben werden.
      </li>
      <li>Nominatim's Ratelimit Problem wird gelöst</li>
      <li>Datenschutz der Endnutzer <a href="#datenschutz">&gt;Dateschutz</a></li>
      <li>Möglichkeit selbst aus dem Verhalten der Nutzer zu lernen <a href="#Statistik">&gt;Statistik</a></li>
    </ul>
    <h3 id="datenschutz">Datenschutz</h3>
    <p>
      Durch einen Proxyserver gelangen die IP-Adresse und sonstige Daten der Endnutzer nicht an den Karten-Provider.<br />
      Zwar behaupten diese, dass sie nichts mit den Daten anfangen, aber sicher ist sicher.
    </p>
    <h3 id="statistik">Statistik</h3>
    <p>
      Durch den Server können außerdem einige nützliche Daten erhoben werden um genauer heraus zu finden, wie der
      Kartenservice genutzt wird. Wie suchen nutzer nach jobs?
    </p>
    <ul>
      <li>Durch Karten scrollen</li>
      <li>Direkte Suchfragen</li>
      <li>Werden verschiedene Orte verglichen?</li>
    </ul>
    <h2 id="karte">Karte</h2>
    <h1 id="roadmap-to-10">Roadmap to 1.0</h1>
    <p>| ---------------- | --------- | | mapload | 40.000 | | geocoding | 55.000 |</p>
    <p>
      <img
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9t676f9uY6NktXtffQfe2WpzRjW7UsmaNxiS427Ej2SLTbmYqBIu2RqKppTpH9FvdssKJSDzg5f3L/pubchart?oid=107232545&amp;format=image"
        alt="Geocoding"
      />
    </p>
    <p>
      <img
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9t676f9uY6NktXtffQfe2WpzRjW7UsmaNxiS427Ej2SLTbmYqBIu2RqKppTpH9FvdssKJSDzg5f3L/pubchart?oid=20924636&amp;format=image"
        alt="MapLoads"
      />
    </p>
    <p>
      <img
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9t676f9uY6NktXtffQfe2WpzRjW7UsmaNxiS427Ej2SLTbmYqBIu2RqKppTpH9FvdssKJSDzg5f3L/pubchart?oid=308843151&amp;format=image"
        alt="TileLoads"
      />
    </p>
    <h3 id="umrechnung-1">Umrechnung</h3>
    <p>
      Ich habe leider nirgendwo einen guten Vergleich gefunden, auch keine Erfahrungsberichte von Leuten die gewechselt
      und ihre Zahlen veröffentlicht haben.
    </p>
    <p>
      Derzeit erreichen wir ca. 40.000 Maploads pro Monat, also ca $80. Für den selben Preis erhalten wir bei Mapbox
      320.000 Tile requests. Bei 40.000 Usern sind das dann 8 Tiles pro User.
    </p>
    <p>
      Für eine detailierte Suche ist das sicherlich nicht ausreichend, aber gleichzeitig gibt es vermutlich auch viele,
      die einfach nur auf die Seite gehen und nicht mit der Karte interagieren.
    </p>
    <p>
      Meine Vermutung ist, dass wir mehr für die Tiles zahlen, jedoch die Kosten für Forward und Reverse Geocoding gegen
      0 gehen werden.
    </p>
    <p>
      Um genau herauszufinden wie viele Tiles der durchschnittliche User benötigt, sollten wir das ganze am besten
      einfach austesten. <a href="#Tests">&gt;Tests</a>
    </p>
    <h2 id="free-1">Free</h2>
    <p>
      Für die Beschaffung der geojson Polygone für z.B. Länderumrisse werden wir sowieso weiterhin
      <a href="https://nominatim.openstreetmap.org/">Nominatim</a> verwenden. Diese Anfragen müssen allerdings gecached
      werden, da Nominatim ein Ratelimit von 1 req/s angibt. <a href="#ProxyServer">&gt;Server</a>
    </p>
    <p>
      Hier kann man sich dann überlegen ob es nicht sinnvoller wäre alle Geocoding Anfragen über Nominatim zu erledigen.
      Solange die Anfragen gecached werden, sehe ich hier keine Nachteile.
    </p>
    <p>
      Matrix oder Isochrone Anfragen zu einem späteren Zeitpunkt müssten dann allerdings trotzdem über Mapbox oder einen
      anderen Anbieter gehen.
    </p>
    <h1 id="tests-1">Tests</h1>
    <p>
      Wie mit Birgit kurz besprochen werde ich dem Server noch ein paar Logging Funktionen hinzufügen,sodass wir nach
      dem Test abschätzen können, wie die Karte genutzt wird.
    </p>
    <p>Hierfür wäre natürlich wichtig zu definieren, was wir alles wissen wollen.</p>
    <ul>
      <li>Requested Tiles pro User</li>
      <li>Suchanfragen</li>
      <li>???</li>
    </ul>
    <h1 id="aufwandsabsch%c3%a4tzung-1">Aufwandsabschätzung</h1>
    <h2 id="proxyserver-1">ProxyServer</h2>
    <p><a href="https://github.com/chronark/charon">github.com/chronark/charon</a></p>
    <p>
      Ich habe vor 1-2 Monaten aus Spaß zu Hause an einer Cache-Implementation in
      <a href="https://golang.org/">go</a> gebastelt, weil ich dachte, dass man sich damit eigentlich sämtliche Kosten
      sparen könnte, da die Anfragen immer weniger sind als das Gratis-Limit.<br />
      Der server ist derzeit unter <a href="jbs-osm.informatik.fh-nuernberg.de">jbs-osm.informatik.fh-nuernberg</a> zu
      finden.
    </p>
    <p>Leider verstößt das gegen die <a href="https://www.mapbox.com/legal/tos">TOS</a> (2.8) von Mapbox.</p>
    <p>Auch wenn wir Tiles und Geocoding von mapbox nicht cachen dürfen, gibt es trotzdem einige Vorteile:</p>
    <ul>
      <li>
        Secrets für diverse APIs erst beim Server hinzugefügt, damit diese nicht im javascript code an den Endnutzer
        weiter gegeben werden.
      </li>
      <li>Nominatim's Ratelimit Problem wird gelöst</li>
      <li>Datenschutz der Endnutzer <a href="#datenschutz">&gt;Dateschutz</a></li>
      <li>Möglichkeit selbst aus dem Verhalten der Nutzer zu lernen <a href="#Statistik">&gt;Statistik</a></li>
    </ul>
    <h3 id="datenschutz-1">Datenschutz</h3>
    <p>
      Durch einen Proxyserver gelangen die IP-Adresse und sonstige Daten der Endnutzer nicht an den Karten-Provider.
      Zwar behaupten diese, dass sie nichts mit den Daten anfangen, aber sicher ist sicher.
    </p>
    <h3 id="statistik-1">Statistik</h3>
    <p>
      Durch den Server können außerdem einige nützliche Daten erhoben werden um genauer heraus zu finden, wie der
      Kartenservice genutzt wird.<br />
      Wie suchen nutzer nach jobs?
    </p>
    <ul>
      <li>Durch Karten scrollen</li>
      <li>Direkte Suchfragen</li>
      <li>Werden verschiedene Orte verglichen?</li>
    </ul>
    <h2 id="karte-1">Karte</h2>
    <h1 id="roadmap-to-10-1">Roadmap to 1.0</h1>
    <h3 id="geocodingtile-request">Geocoding/Tile Request</h3>
    <pre><code class="language-mermaid"><code><div>sequenceDiagram
    Atlas-&gt;&gt;AtlasCache: Request
    alt hit
        AtlasCache-&gt;&gt;Atlas: CacheResult
    else miss
        Atlas-&gt;&gt;CharonAPI: Request
        CharonAPI-&gt;&gt;Cache: Request
        alt miss
            Cache-&gt;&gt;3rdPartyAPI: Request
            3rdPartyAPI-&gt;&gt;Cache: Result
        end
    end
    Cache-&gt;&gt;CharonAPI: CacheResult
    CharonAPI-&gt;&gt;Atlas: CacheResult
</div></code></code></pre>
  </body>
</html>
